<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Hotel Fênix</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="css/global.css">  <link rel="stylesheet" href="css/admin.css">   </head>
  </head>
  <body>
    
    <div id="wrapper">

        <div class="d-flex flex-column" id="sidebar-wrapper">
            <div class="sidebar-heading">
                <i class="bi bi-buildings"></i> Hotel Fênix
            </div>
            
            <nav class="nav nav-pills flex-column p-3">
                <a class="nav-link active" href="admin.html">
                    <i class="bi bi-door-open"></i> Gerenciar Quartos
                </a>
                <a class="nav-link" href="#">
                    <i class="bi bi-calendar-check"></i> Gerenciar Reservas
                </a>
                
                <a class="nav-link mt-auto" href="index.html">
                    <i class="bi bi-box-arrow-left"></i> Sair (Ver site)
                </a>
            </nav>
        </div>

        <div id="page-content-wrapper">
            <main class="container-fluid">
                
                <h1 class="h2 mb-4">Dashboard de Quartos</h1>

                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="card stat-card bg-primary text-white">
                            <div class="card-body">
                                <div>
                                    <h5 class="card-title">Total de Quartos</h5>
                                    <p class="card-text fs-4 fw-bold" id="stat-total-quartos">0</p>
                                </div>
                                <i class="bi bi-door-closed stat-icon"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stat-card bg-success text-white">
                            <div class="card-body">
                                <div>
                                    <h5 class="card-title">Quartos Disponíveis</h5>
                                    <p class="card-text fs-4 fw-bold" id="stat-disponiveis">0</p>
                                </div>
                                <i class="bi bi-check-circle stat-icon"></i>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card stat-card bg-warning text-dark">
                            <div class="card-body">
                                <div>
                                    <h5 class="card-title">Quartos Ocupados</h5>
                                    <p class="card-text fs-4 fw-bold" id="stat-ocupados">0</p>
                                </div>
                                <i class="bi bi-person-fill stat-icon"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2 class="h4 mb-0">Listagem de Quartos</h2>
                    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#modalQuarto" id="btnAdicionarQuarto">
                        <i class="bi bi-plus-lg"></i> Adicionar Novo Quarto
                    </button>
                </div>

                <div class="card card-admin-tabela">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover align-middle">
                                <thead class="table-dark">
                                    <tr>
                                        <th>Nº Quarto (ID)</th>
                                        <th>Nome do Quarto</th>
                                        <th>Camas</th>
                                        <th>Capacidade</th>
                                        <th>Preço (R$)</th>
                                        <th>Status</th>
                                        <th class="text-center">Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="tabela-admin-quartos">
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        </div>
    <div class="modal fade" id="modalQuarto" tabindex="-1" aria-labelledby="modalQuartoLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalQuartoLabel">Adicionar Novo Quarto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="formQuarto">
                        <input type="hidden" id="formQuartoIdAntigo">
                        <div class="mb-3">
                            <label for="formQuartoId" class="form-label">Nº do Quarto (ID)</label>
                            <input type="number" class="form-control" id="formQuartoId" required>
                            <div class="invalid-feedback" id="id-error-feedback">
                                Este número de quarto já está em uso.
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="formQuartoNome" class="form-label">Nome do Quarto</label>
                            <input type="text" class="form-control" id="formQuartoNome" required>
                        </div>
                        <div class="mb-3">
                            <label for="formQuartoCamas" class="form-label">Tipo de Cama</label>
                            <input type="text" class="form-control" id="formQuartoCamas" placeholder="Ex: 1 Cama Casal, 2 Solteiro">
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="formQuartoCapacidade" class="form-label">Capacidade (Pessoas)</label>
                                <input type="number" class="form-control" id="formQuartoCapacidade" min="1" value="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="formQuartoPreco" class="form-label">Preço (R$)</label>
                                <input type="number" class="form-control" id="formQuartoPreco" step="0.01" min="0" value="100.00" required>
                            </div>
                        </div>
                         <div class="mb-3">
                            <label for="formQuartoImagem" class="form-label">URL da Imagem</label>
                            <input type="text" class="form-control" id="formQuartoImagem" placeholder="Ex: img/quarto-novo.jpg">
                        </div>
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" role="switch" id="formQuartoDisponivel" checked>
                            <label class="form-check-label" for="formQuartoDisponivel">Disponível para reserva</label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnSalvarQuarto">Salvar Quarto</button>
                </div>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script src="js/bancoDeDados.js"></script>
    <script src="js/admin.js"></script>
    
</body>

    <script>
      let modalQuartoBootstrap;

      // Função para renderizar a tabela
      function renderizarTabela() {
        const tabelaQuartos = $("#tabela-admin-quartos");
        tabelaQuartos.empty();

        // Ordena os quartos pelo ID (número do quarto)
        // Agora lê da variável global 'bancoDeDadosQuartos'
        bancoDeDadosQuartos.sort((a, b) => a.id - b.id);

        bancoDeDadosQuartos.forEach((quarto) => {
          const precoFormatado = quarto.precoPorNoite.toLocaleString("pt-br", {
            style: "currency",
            currency: "BRL",
          });
          const statusBadge = quarto.disponivel
            ? '<span class="badge bg-success">Disponível</span>'
            : '<span class="badge bg-danger">Indisponível</span>';

          const linhaQuarto = `
                    <tr data-id="${quarto.id}">
                        <td>${quarto.id}</td>
                        <td>${quarto.nome}</td>
                        <td>${quarto.tipoCama}</td>
                        <td>${quarto.capacidade} pessoas</td>
                        <td>${precoFormatado}</td>
                        <td>${statusBadge}</td>
                        <td class="text-center">
                            <button class="btn btn-primary btn-sm btn-alterar" data-id="${quarto.id}" title="Alterar">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-danger btn-sm btn-excluir" data-id="${quarto.id}" title="Excluir">
                                <i class="bi bi-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
          tabelaQuartos.append(linhaQuarto);
        });
      }

      // Função para verificar se um ID (número do quarto) já existe
      function idJaExiste(idNovo, idAntigo = null) {
        const idNovoNum = parseInt(idNovo);
        return bancoDeDadosQuartos.some((quarto) => {
          if (idAntigo && quarto.id === parseInt(idAntigo)) {
            return false;
          }
          return quarto.id === idNovoNum;
        });
      }

      // ======================================================
      // CÓDIGO A SER EXECUTADO QUANDO A PÁGINA CARREGA
      // ======================================================
      $(document).ready(function () {
        // 1. CARREGA OS DADOS DO LOCALSTORAGE
        // (Isso preenche a variável 'bancoDeDadosQuartos')
        carregarDados();

        modalQuartoBootstrap = new bootstrap.Modal("#modalQuarto");

        // 2. Renderiza a tabela pela primeira vez com os dados carregados
        renderizarTabela();

        // 3. Ação: ADICIONAR (Prepara o Modal)
        $("#btnAdicionarQuarto").on("click", function () {
          $("#modalQuartoLabel").text("Adicionar Novo Quarto");
          $("#formQuarto").trigger("reset");
          $("#formQuartoIdAntigo").val("");
          $("#formQuartoId").prop("readonly", false);
          $("#formQuartoId").removeClass("is-invalid");
          $("#formQuartoDisponivel").prop("checked", true);
        });

        // 4. Ação: ALTERAR (Prepara o Modal)
        $("#tabela-admin-quartos").on("click", ".btn-alterar", function () {
          const quartoId = $(this).data("id");
          // Busca no array global
          const quarto = bancoDeDadosQuartos.find((q) => q.id == quartoId);

          if (quarto) {
            $("#modalQuartoLabel").text("Alterar Quarto");
            $("#formQuartoIdAntigo").val(quarto.id);
            $("#formQuartoId").val(quarto.id);
            $("#formQuartoId").removeClass("is-invalid");

            $("#formQuartoNome").val(quarto.nome);
            $("#formQuartoCamas").val(quarto.tipoCama);
            $("#formQuartoCapacidade").val(quarto.capacidade);
            $("#formQuartoPreco").val(quarto.precoPorNoite);
            $("#formQuartoImagem").val(quarto.imagem);
            $("#formQuartoDisponivel").prop("checked", quarto.disponivel);

            modalQuartoBootstrap.show();
          }
        });

        // 5. Ação: SALVAR (Dentro do Modal)
        $("#btnSalvarQuarto").on("click", function () {
          const idAntigo = $("#formQuartoIdAntigo").val();
          const idNovo = $("#formQuartoId").val();

          if (!idNovo) {
            alert("O Número do Quarto (ID) é obrigatório.");
            return;
          }

          if (idJaExiste(idNovo, idAntigo)) {
            $("#formQuartoId").addClass("is-invalid");
            return;
          }

          $("#formQuartoId").removeClass("is-invalid");

          const dadosQuarto = {
            id: parseInt(idNovo),
            nome: $("#formQuartoNome").val(),
            tipoCama: $("#formQuartoCamas").val(),
            capacidade: parseInt($("#formQuartoCapacidade").val()),
            precoPorNoite: parseFloat($("#formQuartoPreco").val()),
            imagem: $("#formQuartoImagem").val(),
            disponivel: $("#formQuartoDisponivel").is(":checked"),
          };

          if (idAntigo) {
            // MODO DE EDIÇÃO
            const index = bancoDeDadosQuartos.findIndex(
              (q) => q.id == idAntigo
            );
            if (index !== -1) {
              bancoDeDadosQuartos[index] = dadosQuarto;
            }
          } else {
            // MODO DE ADIÇÃO
            bancoDeDadosQuartos.push(dadosQuarto);
          }

          // *** AQUI ESTÁ A MUDANÇA PRINCIPAL ***
          // Salva o array modificado no localStorage
          salvarDados();

          modalQuartoBootstrap.hide();
          renderizarTabela(); // Recarrega a tabela com dados atualizados
        });

        // 6. Ação: EXCLUIR
        $("#tabela-admin-quartos").on("click", ".btn-excluir", function () {
          const quartoId = $(this).data("id");

          if (
            confirm(
              "Tem certeza que deseja excluir o quarto nº " + quartoId + "?"
            )
          ) {
            const index = bancoDeDadosQuartos.findIndex(
              (q) => q.id == quartoId
            );
            if (index !== -1) {
              bancoDeDadosQuartos.splice(index, 1);

              // *** AQUI ESTÁ A MUDANÇA PRINCIPAL ***
              // Salva o array modificado no localStorage
              salvarDados();

              renderizarTabela();
            }
          }
        });
      });
    </script>
  </body>
</html>
